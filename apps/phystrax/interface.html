<html>
  <head>
    <link rel="stylesheet" href="../../css/spectre.min.css">
  </head>
  <body>
    <div id="data"></div>

    <script src="../../core/lib/interface.js"></script>
    <script>
      var dataElement = document.getElementById("data");

      function getHeartRateData() {
        Util.showModal("Loading...");
        dataElement.innerHTML = "";
        Puck.eval('require("Storage").list(/heart_rate_data\\.csv\\x01/)', files => {
          if (files.length == 0) {
            dataElement.innerHTML = "<p>No heart rate data found</p>";
          } else {
            files.forEach(fn => {
              fn = fn.slice(0, -1);
              var link = document.createElement("a");
              link.setAttribute("href", "#");
              link.textContent = fn;
              link.addEventListener("click", function() {
                Util.showModal("Downloading...");
                Util.readStorageFile(fn, function(data) {
                  Util.saveCSV(fn.slice(0, -4), data);
                  console.log("Downloaded file path:", fn); // Print file path to console
                  Util.hideModal();
                });
              });
              dataElement.appendChild(link);
              dataElement.appendChild(document.createElement("br"));
            });
          }
          Util.hideModal();
        });
      }

      function deleteHeartRateData() {
        Util.showModal("Deleting...");
        require("Storage").erase("heart_rate_data.csv", function() {
          Util.hideModal();
          getHeartRateData();
        });
      }

      // Called when app starts
      function onInit() {
        getHeartRateData();
      }
    </script>
  </body>
</html>
