<html>
  <head>
    <link rel="stylesheet" href="../../css/spectre.min.css">
  </head>
  <body>
    <h3>Upload Tigger</h3>
    <p><textarea id="triggers" style="width:500px; height:300px">Load data...</textarea></p>
    <p><button id="upload" class="btn btn-primary">Upload</button></p>

    <script src="../../core/lib/customize.js"></script>

    <script>
        /*
         * Load trigger from BangleJs
         */
        console.log("Loading trigger from BangleJs...");
        var loadedData = false;
        try {
            Puck.eval(`require("Storage").read(${JSON.stringify("ha.trigger.json")})`,data=>{
                document.getElementById("triggers").innerHTML = data;
                console.log("Successfully loaded trigger from BangleJs.");
                console.log(data);
                loadedData = true;
            });
        } finally {
            if(!loadedData){
                console.log("(Warning) Could not load trigger from BangleJs.");
                console.log(ex);
                document.getElementById("triggers").innerHTML = `
[
  {"display": "Open", "trigger": "OPEN_DOOR", "icon":"door"},
  {"display": "Office", "trigger": "TOGGLE_LIGHT", "icon":"light"},
  {"display": "Living Room", "trigger": "OVEN", "icon":"fire"}
]`
            }
        }

        /*
         * Upload trigger to BangleJs
         */
        document.getElementById("upload").addEventListener("click", function() {
            // get the text to add
            var triggerText = document.getElementById("triggers").value;
            // send finished app (in addition to contents of app.json)
            sendCustomizedApp({
            storage:[
                {name:"ha.trigger.json", url:"ha.trigger.json", content:triggerText},
            ]
            });
            console.log("Sent ha.trigger.json!");
        });

    </script>
  </body>
</html>
